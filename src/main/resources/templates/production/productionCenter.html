<!DOCTYPE html>
<html>
<head>
    <title>创新创业平台</title>
    <link href="../../static/css/bootstrap.min.css" th:href="@{/css/bootstrap.min.css}" rel="stylesheet" type="text/css">
    <link href="../../static/css/bootstrap-combined.min.css" th:href="@{/css/bootstrap-combined.min.css}" rel="stylesheet" type="text/css">
    <script src="../../static/js/jquery-3.3.1.min.js" th:src="@{/js/jquery-3.3.1.min.js}"></script>
    <script src="../../static/js/bootstrap.min.js"  th:src="@{/js/bootstrap.min.js}"></script>
</head>
<body>
<div th:replace="top::html" ></div>
<div class="span10 " th:if="${productionPage} == null">还没有作品，请继续加油
    <button class="btn btn-info" type="button" style="float:right;margin-top:20px;margin-right:20px" th:onclick="'javascript:clickHandler()'">发表作品</button>
</div>
<div class="container-fluid" th:if="${productionPage} != null">

    <div class="row-fluid" >
        <div class="span12">
            <button class="btn btn-info" type="button" style="float:right;margin-top:20px;margin-right:20px" th:onclick="'javascript:clickHandler()'">发表作品</button>

        </div>
    </div>


    <div class="row-fluid">
        <div class="span12" >
            <table align="center" class="table">
                <thead>
                <tr>
                    <th style="width:30%;text-align:center">
                        作品名称
                    </th>
                    <th style="width:20%;text-align:center">
                        发布时间
                    </th>
                    <th style="text-align:center">
                        审核状态
                    </th>
                    <th style="text-align:center">
                        操作
                    </th>
                    <th style="text-align:center">
                        操作
                    </th>
                    <th style="text-align:center">
                        操作
                    </th>
                </tr>
                </thead>
                <tbody th:each="p : ${productionPage}">

                <tr>
                    <td style="text-align:center" th:text="${p.ptitle}">
                    </td>
                    <td style="text-align:center" th:text="${#dates.format(p.puploadTime,'yyyy-MM-dd')}">
                    </td>
                    <td style="text-align:center" th:if="${p.pCheck} == '0'">
                        审核通过
                    </td>
                    <td style="text-align:center" th:if="${p.pCheck} == '1'">
                        未审核
                    </td>
                    <td style="text-align:center" th:if="${p.pCheck} == '2'">
                        审核不通过
                    </td>
                    <td style="text-align:center" >
                        <a th:href="@{'/production/'+${p.pId}}">查看</a>
                    </td>
                    <td style="text-align:center" >
                        <a th:href="@{'/production/toEditProduction?username='+${userName}+'&pId='+${p.pId}}">编辑</a>
                    </td>
                    <td style="text-align:center" >
                        <button class="btn btn-link" type="button" th:onclick="'deletePro('+${p.pId}+')'">删除</button>
                    </td>
                </tr>

                </tbody>
            </table>
        </div>
    </div>

<div class="col-md-12 column">
    <ul class="pagination pull-right">
        <li class="disabled" th:if="${page} eq '1'" ><a href="#">首页</a></li>
        <li th:if="${page} ne '1'"><a th:href="${url}+'?page=1&size='+${size}">首页</a></li>
        <li class="disabled" th:if="${page} le '1'"><a href="#">上一页</a></li>
        <li th:if="${page} gt '1'"><a th:href="${url}+'?page='+${page-1}+'&size='+${size}">上一页</a></li>
        <li th:each="pageNo : ${#numbers.sequence(1, productionPage.getTotalPages())}">
            <a th:if="${pageNo} eq ${page}" style="background-color: #b2b2b2;color: white" th:text="${pageNo}"></a>
            <a th:if="${pageNo} ne ${page} and ${pageNo} le ${page+2} and ${pageNo} ge ${page-2}" th:href="${url}+'?page='+${pageNo}+'&size='+${size}" th:text="${pageNo}"></a>
        </li>
        <li th:if="${page} lt ${productionPage.getTotalPages()}"><a th:href="${url}+'?page='+${page+1}+'&size='+${size}">下一页</a></li>
        <li class="disabled" th:if="${page} ge ${productionPage.getTotalPages()}"><a>下一页</a></li>
        <li class="disabled" th:if="${page} eq ${productionPage.getTotalPages()}"><a>尾页</a></li>
        <li th:if="${page} ne ${productionPage.getTotalPages()}"><a th:href="${url}+'?page='+${productionPage.getTotalPages()}+'&size='+${size}">尾页</a></li>
    </ul>
</div>
</div>
<input type="hidden" id="username" th:value="${userName}">

<script type="text/javascript">
        var username  = $("#username").val();
    function deletePro(pId) {

        var toUrl ="/production/"+username+"/deleteProduction/"+pId;
        var con=confirm("是否确认删除？");
        if(con==true)
           find1(toUrl);
    }
    function find1(toUrl) {
        $.ajax({
            type:"get",
            url:toUrl,
            async: false,
            contentType:"application/json;charset=utf-8",
            data:{},
            success:function(datas){
                if(datas.code != 0){
                    alert("删除失败");
                }else{
                    location.reload(true);
                }

            },
            error : function(result) {

            }
        });

    }


    function clickHandler() {
        window.location.href='/production/totest';
    }
</script>
</body>
</html>